"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e){e.fn.createInputs=function(){var t=e('<ol class="onecheck-list"></ol>'),a=e("html"),n=JSON.parse(a.jqmData("day")).year,s=(JSON.parse(localStorage.getItem(n))||{})[JSON.parse(a.jqmData("day")).day]||[],r=!0,i=!1,c=void 0;try{for(var o,h=s[Symbol.iterator]();!(r=(o=h.next()).done);r=!0){var l=o.value,f=e('\n  <li class="onecheck-list__item">\n    <label class="onecheck-checkbox">\n      <input type="checkbox" class="onecheck-checkbox__input" '+(l.done?"checked":"")+'>\n      <span class="onecheck-checkbox__check"></span>\n    </label>\n    <label class="onecheck-text">\n\t\t\t<textarea class="onecheck-text__textarea" data-onecheck-text>\n\t\t\t\t\t\t\t\n\t\t\t</textarea>\n\t\t</label>\n  </li>');f.find("textarea").textinput().val(l.text),f.appendTo(t)}}catch(e){i=!0,c=e}finally{try{!r&&h.return&&h.return()}finally{if(i)throw c}}return t.append(e('\n\t\t<li class="onecheck-list__item">\n\t\t\t<label class="onecheck-checkbox">\n\t\t\t\t<input type="checkbox" class="onecheck-checkbox__input">\n\t\t\t\t<span class="onecheck-checkbox__check"></span>\n\t\t\t</label>\n\t\t\t<label class="onecheck-text">\n\t\t\t\t<textarea class="onecheck-text__textarea" data-onecheck-text>\n\t\t\t\t\t\t\t\t\n\t\t\t\t</textarea>\n\t\t\t</label>\n\t\t</li>').find("textarea").val("").textinput().end()),this.find('[data-role="content"]').html("").append(t),t.listview(),this},e.fn.observeChange=function(){var t=e("html"),a=JSON.parse(t.jqmData("day")).year;return this.find("li").each(function(n){var s=this;e(this).find("input").change(function(){e(s).find("textarea").trigger("onecheck.change",e(s).find("textarea")[0])}),e(this).find("textarea").off("onecheck.change").on("onecheck.change",function(r,i){var c=JSON.parse(localStorage.getItem(a))||{},o=c[JSON.parse(t.jqmData("day")).day]||[],h={};""!==e(s).find("textarea").val()&&(h.done=e(s).find('[type="checkbox"]').is(":checked"),h.text=e(s).find("textarea").val(),o[n]=h),c[JSON.parse(t.jqmData("day")).day]=o,localStorage.setItem(a,JSON.stringify(c))}).off("keydown").on("keydown",function(s){if(8===s.keyCode){var r=JSON.parse(localStorage.getItem(a))||{},i=r[JSON.parse(t.jqmData("day")).day]||[];""===e(this).val()&&e(this).parents("li").prev().length&&(e(this).parents("li").prev().find("textarea").focus(),e(this).parents("li").remove(),i.splice(n,1),r[JSON.parse(t.jqmData("day")).day]=i,localStorage.setItem(a,JSON.stringify(r))),""!==e(this).val()||e(this).parents("li").siblings().length||(i=[],r[JSON.parse(t.jqmData("day")).day]=i,localStorage.setItem(a,JSON.stringify(r)))}})}),this},e(function(){e("html").on("keydown","[data-onecheck-text]",function(t){if(13===t.keyCode){if(t.preventDefault(),e(this).val().replace(/ /g,"")){var a=void 0;e(this).parents("li").next().length?e(this).parents("li").next().find("textarea").focus():(a=e('\n<li class="onecheck-list__item">\n    <label class="onecheck-checkbox">\n      <input type="checkbox" class="onecheck-checkbox__input" >\n      <span class="onecheck-checkbox__check"></span>\n    </label>\n    <label class="onecheck-text">\n\t\t\t<textarea class="onecheck-text__textarea" data-onecheck-text>\n\t\t\t\t\t\t\t\n\t\t\t</textarea>\n\t\t</label>\n</li>\t\t\t\t\n'),e(this).parents("li").after(a),e(this).parents("ol").listview("refresh").observeChange(),a.find("textarea").val("").focus().textinput())}e(this).trigger("onecheck.change",this)}}).on("change","[data-onecheck-text]",function(){e(this).trigger("onecheck.change",this)})})}(jQuery),function(e){e(function(){e("#day").on("pagebeforeshow",function(){e(this).createInputs().find("ol").observeChange()}).on("pageshow",function(){console.log(this),e(this).find("textarea").focus()})})}(jQuery);var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),WEEK=6048e5;Date.prototype.getWeek=function(){var e=new Date(this.valueOf()),t=(this.getDay()+6)%7;e.setDate(e.getDate()-t+3);var a=e.valueOf();return e.setMonth(0,1),4!==e.getDay()&&e.setMonth(0,1+(1-e.getDay()+7)%7),Math.ceil((a-e)/WEEK)};var Callendar=function(){function e(){_classCallCheck(this,e),this.russianDays=["понедльник","вторник","среда","четверг","пятница","суббота","воскресенье"],this.russianMonth=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],this._date=new Date,this.year=this._date.getFullYear(),this.seasoneStarts=[],this.week=this._date.getWeek();for(var t=0;t<8;t++)this._initSeasonStarts(t);for(var a=0;a<this.seasoneStarts.length-1;a++){this.seasoneStarts[a].weeks=[];for(var n=new Date(this.seasoneStarts[a].getTime());n<this.seasoneStarts[a+1];n.setTime(n.getTime()+WEEK))this.seasoneStarts[a].weeks.push(n.getWeek())}for(this.seasoneStarts[7].weeks=[],this._finish=new Date(this.year+1,11,1);1!==this._finish.getDay();)this._finish.setDate(this._finish.getDate()+1);for(var s=new Date(this.seasoneStarts[7].getTime());s<this._finish;s.setTime(s.getTime()+WEEK))this.seasoneStarts[7].weeks.push(s.getWeek())}return _createClass(e,[{key:"_initSeasonStarts",value:function(e){var t=this.year,a=e%4*3||12;0===e&&(t=this.year-1),e>4&&(t=this.year+1);for(var n=1;n<8;n++)1===new Date(t+"/"+a+"/"+n).getDay()&&(this.seasoneStarts[e]=new Date(t+"/"+a+"/"+n))}},{key:"getDay",value:function(e){var t=e.getDate(),a=e.getDay(),n=e.getMonth();return arguments.length<1?console.error("Не хватает данных для построения строки"):(0===a?a=6:a-=1,t+" "+this.russianMonth[n]+" "+this.russianDays[a])}}]),e}(),getWeekDates=function(e,t){var a=new Date(e,0,1);1!==a.getDay()&&a.setDate(1+(1-a.getDay()+7)%7),a=new Date(a.valueOf()+6048e5*(t-1));for(var n=[],s=0;s<7;s++){var r=new Date(a.valueOf()+24*s*3600*1e3),i="";switch(r.getDay()){case 0:i="воскресенье";break;case 1:i="понедельник";break;case 2:i="вторник";break;case 3:i="среда";break;case 4:i="четверг";break;case 5:i="пятница";break;case 6:i="суббота"}var c="";switch(r.getMonth()){case 0:c="января";break;case 1:c="февраля";break;case 2:c="марта";break;case 3:c="апреля";break;case 4:c="мая";break;case 5:c="июня";break;case 6:c="июля";break;case 7:c="августа";break;case 8:c="сентября";break;case 9:c="октября";break;case 10:c="ноября";break;case 11:c="декабря"}n.push(r.getDate()+" "+c+" "+i)}return n},CALLENDAR=new Callendar,createSeasonLink=function(e){var t="";switch(e.getMonth()){case 8:t="Осень "+e.getFullYear();break;case 11:t="Зима "+e.getFullYear();break;case 5:t="Лето "+e.getFullYear();break;case 2:t="Весна "+e.getFullYear()}return $('<li><a href="#season" data-change-date></a></li>').find("a").jqmData("seasonStart",e).html(t).end()},createWeeksLink=function(e){return $("<li>").append($('<a href="#week" data-change-date>'+e+" неделя</a>").jqmData("week",e))},createDaysLinks=function(e,t){52===$("html").jqmData("week")&&parseInt(e)<7&&t++;var a=JSON.stringify({day:e,year:t});return $("<li>").append($('<a href="#day" data-change-date> '+e+" </a>").jqmData("day",a))};$(function(){var e=$("html");e.on("click","[data-change-date]",function(){e.jqmData("seasonStart",$(this).jqmData("seasonStart")),e.jqmData("week",$(this).jqmData("week")),e.jqmData("day",$(this).jqmData("day"))}),$("#seasons-list").on("listviewcreate",function(){var e=!0,t=!1,a=void 0;try{for(var n,s=CALLENDAR.seasoneStarts[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var r=n.value;$(this).append(createSeasonLink(r))}}catch(e){t=!0,a=e}finally{try{!e&&s.return&&s.return()}finally{if(t)throw a}}$(this).listview("refresh")});var t=[];$("#season").on("pagebeforeshow",function(){var a="",n=e.jqmData("seasonStart").getMonth(),s=e.jqmData("seasonStart").getFullYear();switch(n){case 8:a="Осень "+s,$(this).jqmData("header-text",a);break;case 11:a="Зима "+s,$(this).jqmData("header-text",a);break;case 5:a="Лето "+s,$(this).jqmData("header-text",a);break;case 2:a="Весна "+s,$(this).jqmData("header-text",a);break;default:a=$(this).jqmData("header-text")}t=e.jqmData("seasonStart").weeks,$(this).find("h2").html(a).parents(".ui-header").toolbar("refresh"),$("#weeks-list").each(function(){$(this).html("");var e=!0,a=!1,n=void 0;try{for(var s,r=t[Symbol.iterator]();!(e=(s=r.next()).done);e=!0){var i=s.value;$(this).append(createWeeksLink(i))}}catch(e){a=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(a)throw n}}}).listview({splitIcon:"none"}).listview("refresh"),$(this).find("li a").each(function(){var t=parseInt(255*Math.random()),a=parseInt(255*Math.random()),n=parseInt(255*Math.random());$(this).css({"background-color":"rgb("+t+","+a+","+n+")"}),t>210&&a>210&&n>210&&$(this).css("color","#333");var s=e.jqmData("seasonStart").getFullYear(),r=$(this).jqmData("week");r<10&&s++,r===CALLENDAR.week&&s===CALLENDAR.year&&$(this).addClass("onecheck-current-week")})}),$("#week").on("pagebeforeshow",function(){var t=e.jqmData("week"),a=e.jqmData("seasonStart").getFullYear();t<10&&a++,$(this).find("h2").html(t+" неделя"),$(this).find("#days-list").html("").each(function(){var e=getWeekDates(a,t),n=!0,s=!1,r=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done);n=!0){var o=i.value;$(this).append(createDaysLinks(o,a))}}catch(e){s=!0,r=e}finally{try{!n&&c.return&&c.return()}finally{if(s)throw r}}}).listview("refresh")}),$("#day").on("pagebeforeshow",function(){var t=JSON.parse(e.jqmData("day")).day;$(this).find("h2").html(t)})}),$.mobile.defaultPageTransition="slide";